<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="IE=Edge, Chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Browse</title>
    <link href="../asset/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../asset/easyDialog/css/easydialog.css" rel="stylesheet" type="text/css" />
    <link href="../asset/css/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <div class="header">
        <div class="nav">
            <div class="logo">
                <img src="../asset/img/logo.png" />
            </div>
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a href="browse.html">Browse</a>
                </li>
                <li class="nav-item">
                    <a href="#">Search</a>
                </li>
                <li class="nav-item">
                    <a href="#">About Us</a>
                </li>
            </ul>
            <div class="header-title clearfix">
                <div class="header-icon"></div>
                <div class="header-text">LOGO</div>
            </div>
        </div>
    </div>
    <div class="banner"></div>
    <div class="browse body">
        <ul class="nav-list" id="navbar">
            <li class="nav-item nav-item-top">Hydrolases</li>
            <li class="nav-item">Lyases</li>
            <li class="nav-item">Isomerases</li>
            <li class="nav-item">Ligases</li>
            <li class="nav-item">Oxidoreductases</li>
            <li class="nav-item nav-item-bottom">Transferase</li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active">
                <div class="intro-con">
                    <h1 id="browseTitle" class="intro-title"></h1>
                    <div id="browseContent" class="intro-content"></div>
                </div>
                <div class="pane-pic"></div>
            </div>
            <div class="tab-pane">
                <div class="catalog-con">
                    <h1 class="catalog-title">Index of Marie Enzyme</h1>
                    <div class="catalog-index" id="catalog">
                        <span class="catalog-links">A</span>
                        <span class="catalog-links">B</span>
                        <span class="catalog-links">C</span>
                        <span class="catalog-links">D</span>
                        <span class="catalog-links">E</span>
                        <span class="catalog-links">F</span>
                        <span class="catalog-links">G</span>
                        <span class="catalog-links">H</span>
                        <span class="catalog-links">I</span>
                        <span class="catalog-links">J</span>
                        <span class="catalog-links">K</span>
                        <span class="catalog-links">L</span>
                        <span class="catalog-links">M</span>
                        <span class="catalog-links">N</span>
                        <span class="catalog-links">O</span>
                        <span class="catalog-links">P</span>
                        <span class="catalog-links">Q</span>
                        <span class="catalog-links">R</span>
                        <span class="catalog-links">S</span>
                        <span class="catalog-links">T</span>
                        <span class="catalog-links">U</span>
                        <span class="catalog-links">V</span>
                        <span class="catalog-links">W</span>
                        <span class="catalog-links">X</span>
                        <span class="catalog-links">Y</span>
                        <span class="catalog-links">Z</span>
                    </div>
                    <table class="catalog-table table table-bordered">
                        <thead>
                        <tr>
                            <th>LOCUS</th>
                            <th>EC2</th>
                            <th>TITLE</th>
                        </tr>
                        </thead>
                        <tbody id="tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="footer-con">
            <div class="footer-links">
                links: www.ysfri.ac.cn
            </div>
            <div class="footer-logo">
                <img src="../asset/img/logo.png" />
            </div>
            <div class="footer-info">
                Address:Nanjing Road, Qingdao City, 106, Post Code:266071 Tel: 0532 85800117 Fax: 0532 85811514<br/>
                All rights reserved: Yellow Sea Fisheries Research Institute<br/>
                Network Operation and Management: Yellow Sea Fisheries Research Institute Information Center Lu<br/>
                ICP: 05024434 Lu public network equipment 37020202000458
            </div>
        </div>
    </div>
    <script src="../asset/js/frame/jquery-1.11.1.min.js"></script>
    <script src="../asset/bootstrap/js/bootstrap.min.js"></script>
    <script src="../asset/easyDialog/js/easydialog.min.js"></script>
    <script>
        $(document).ready(function() {
            var search = location.search,
                ec1Current = "",
                ec1 = "";

            if(search !== "") {
                ec1 = search.split("=")[1];
                console.log(ec1);
                ec1Current = ec1;
                link(ec1, "A");

                // 切换到目录Tab
                $(".tab-pane").eq(0).removeClass("active").end().eq(1).addClass("active");
            }

            $("#navbar").find(".nav-item").on("click", function(e) {
                var ec1 = $(e.target).text();
                ec1Current = ec1;
                link(ec1Current, "A");

                // 切换到目录Tab
                $(".tab-pane").eq(0).removeClass("active").end().eq(1).addClass("active");
            });

            $("#catalog").find(".catalog-links").on("click", function(e) {
                var prefix = $(e.target).text();
                link(ec1Current, prefix);
            });
            /**
             * 获取数据列表
             * @param ec1    酶大类
             * @param prefix 首字母
             */
            function link(ec1, prefix) {
                var tbody = $("#tbody");
                tbody.empty();
                $.ajax({
                    type: "post",
                    url: "/getFrontList",
                    data: {
                        ec1: ec1,
                        prefix: prefix
                    },
                    success: function (msg) {
                        var data = msg.data,
                            item = null,
                            length = data.length,
                            loop = 0;

                        for (loop = 0; loop < length; loop++) {
                            item = data[loop];
                            $data = "<tr><td><a style='text-decoration: underline;' href='detail.html?locus=" + item.locus + "'>" + item.locus + "</a></td><td>" + item.ec2 + "</td><td>" + item.title + " </td></tr>";
                            tbody.append($data);
                        }
                    },
                    error: function (msg) {
                        Dialog.warn("连接服务器失败！");
                    }
                })
            }

            var info = sessionStorage.getItem("info");

            if(!info) {
                $.ajax({
                    type: "POST",
                    url: "",
                    data: {},
                    success: function(msg) {
                        var data = JSON.stringify(msg.data);

                        if(Number(msg.code) === 1) {
                            sessionStorage.setItem("info", data);
                            paint(data)
                        } else {
                            alert(msg.msg);
                        }
                    },
                    error: function(msg) {
                        alert("连接服务器失败！");
                    }
                })
            } else {
                paint(info);
            }

            /**
             * 渲染页面：将数据填入到页面指定位置
             * @param data 页面数据
             */
            function paint(data) {
                var param = {},
                    data = JSON.parse(data),
                    item = null,
                    length = 0,
                    loop = 0;

                for(loop = 0, length = data.length; loop < length; loop++) {
                    item = data[loop];
                    param[item.param] = item.value;
                }

                $("#browseTitle").text(param.browseTitle);
                $("#browseContent").html(param.browseContent);
            }
        })
    </script>
</body>
</html>