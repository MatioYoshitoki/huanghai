<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=Edge, Chrome=1">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <title>数据录入</title>
    <link rel="stylesheet" href="vendor/bootstrap-select/bootstrap-select.css">
    <link rel="stylesheet" href="vendor/bootstrap-datepicker/datepicker.css">
    <link rel="stylesheet" href="../asset/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../asset/easyDialog/css/easydialog.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.min.css">

    <link rel="stylesheet" href="css/main.css">
    <!--[if lt IE 9]>
        <script src="js/html5shiv.js"></script>
        <script src="js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="app" data-sidebar="locked" id="client">
    <navbar :user="user" :message="message"></navbar>
    <section class="layout">
        <sidebar :links="sidebarLinks"></sidebar>
        <section class="main-content">
            <div class="content-wrap">
                <div class="row mg-b">
                    <div class="col-xs-12">
                        <h3 class="no-margin">数据录入</h3>
                        <small>手工往数据库内录入数据</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <section class="panel">
                            <div class="panel-body padding">
                                <form class="form-horizontal">
                                    <div class="form-group">
                                        <label class="col-sm-1 control-label"><span class="text-danger">*</span>TITLE</label>
                                        <div class="col-sm-11">
                                            <input v-model="create.title" placeholder="Chain A, Structure Analysis Of A New Psychrophilic Marine Protease" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-1 control-label"><span class="text-danger">*</span>分类</label>
                                        <div class="col-sm-5">
                                            <select id="selectForType" class="form-control selectpicker" data-style="btn-primary"></select>
                                        </div>
                                        <label class="col-sm-1 control-label"><span class="text-danger">*</span>EC2</label>
                                        <div class="col-sm-5">
                                            <select id="selectForEC2" class="form-control selectpicker" data-style="btn-primary"></select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-1 control-label"><span class="text-danger">*</span>LOCUS</label>
                                        <div class="col-sm-3">
                                            <input v-model="create.locus" placeholder="3U1R_A" type="text" class="form-control">
                                        </div>
                                        <label class="col-sm-1 control-label"><span class="text-danger">*</span>PDBID</label>
                                        <div class="col-sm-3">
                                            <input v-model="create.pdbId" placeholder="3U1R" type="text" class="form-control">
                                        </div>
                                        <label class="col-sm-1 control-label"><span class="text-danger">*</span>DATE</label>
                                        <div class="col-sm-3">
                                            <input v-model="create.date" placeholder="02-NOV-2012" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-1 control-label">DBSOURCE</label>
                                        <div class="col-sm-11">
                                            <textarea v-model="create.dbsource" class="form-control" rows="3"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-1 control-label">SOURCE</label>
                                        <div class="col-sm-11">
                                            <input v-model="create.source" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-1 control-label">ORGANISM</label>
                                        <div class="col-sm-11">
                                            <textarea v-model="create.organism" class="form-control" rows="3"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-1 control-label">MICROBE</label>
                                        <div class="col-sm-8">
                                            <input v-model="create.microbe" type="text" class="form-control">
                                        </div>
                                        <label class="col-sm-1 control-label">COUNTRY</label>
                                        <div class="col-sm-2">
                                            <input v-model="create.country" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div v-show="referShow[0]">
                                        <h4 class="mg">REFERENCE 1：</h4>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">TITLE</label>
                                            <div class="col-sm-11">
                                                <input v-model="create.title1" type="text" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">AUTHOR</label>
                                            <div class="col-sm-5">
                                                <input v-model="create.author1" type="text" class="form-control">
                                            </div>
                                            <label class="col-sm-1 control-label">JOURNAL</label>
                                            <div class="col-sm-2">
                                                <input v-model="create.journal1" type="text" class="form-control">
                                            </div>
                                            <label class="col-sm-1 control-label">PUBMED</label>
                                            <div class="col-sm-2">
                                                <input v-model="create.pubmed1" type="text" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">ABSTRACT</label>
                                            <div class="col-sm-11">
                                                <textarea v-model="create.abstract1" class="form-control" rows="3"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-show="referShow[1]">
                                        <h4 class="mg">REFERENCE 2：</h4>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">TITLE</label>
                                            <div class="col-sm-11">
                                                <input v-model="create.title2" type="text" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">AUTHOR</label>
                                            <div class="col-sm-5">
                                                <input v-model="create.author2" type="text" class="form-control">
                                            </div>
                                            <label class="col-sm-1 control-label">JOURNAL</label>
                                            <div class="col-sm-2">
                                                <input v-model="create.journal2" type="text" class="form-control">
                                            </div>
                                            <label class="col-sm-1 control-label">PUBMED</label>
                                            <div class="col-sm-2">
                                                <input v-model="create.pubmed2" type="text" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">ABSTRACT</label>
                                            <div class="col-sm-11">
                                                <textarea v-model="create.abstract2" class="form-control" rows="3"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-show="referShow[2]">
                                        <h4 class="mg">REFERENCE 3：</h4>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">TITLE</label>
                                            <div class="col-sm-11">
                                                <input v-model="create.title3" type="text" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">AUTHOR</label>
                                            <div class="col-sm-5">
                                                <input v-model="create.author3" type="text" class="form-control">
                                            </div>
                                            <label class="col-sm-1 control-label">JOURNAL</label>
                                            <div class="col-sm-2">
                                                <input v-model="create.journal3" type="text" class="form-control">
                                            </div>
                                            <label class="col-sm-1 control-label">PUBMED</label>
                                            <div class="col-sm-2">
                                                <input v-model="create.pubmed3" type="text" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">ABSTRACT</label>
                                            <div class="col-sm-11">
                                                <textarea v-model="create.abstract3" class="form-control" rows="3"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-show="referShow[3]">
                                        <h4 class="mg">REFERENCE 4：</h4>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">TITLE</label>
                                            <div class="col-sm-11">
                                                <input v-model="create.title4" type="text" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">AUTHOR</label>
                                            <div class="col-sm-5">
                                                <input v-model="create.author4" type="text" class="form-control">
                                            </div>
                                            <label class="col-sm-1 control-label">JOURNAL</label>
                                            <div class="col-sm-2">
                                                <input v-model="create.journal4" type="text" class="form-control">
                                            </div>
                                            <label class="col-sm-1 control-label">PUBMED</label>
                                            <div class="col-sm-2">
                                                <input v-model="create.pubmed4" type="text" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">ABSTRACT</label>
                                            <div class="col-sm-11">
                                                <textarea v-model="create.abstract4" class="form-control" rows="3"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-if="referLength < 3" @click="addReference()" class="btn btn-default center-block mg-b" style="width: 150px;">新增引用</div>
                                    <div class="form-group">
                                        <label class="col-sm-1 control-label">ORIGIN</label>
                                        <div class="col-sm-11">
                                            <textarea v-model="create.origin" class="form-control" rows="5"></textarea>
                                        </div>
                                    </div>
                                    <div @click="request('createData')" class="btn btn-default center-block" style="width: 150px;">提交数据</div>
                                </form>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </section>
    </section>
</div>
<script src="../asset/js/frame/jquery-1.11.1.min.js"></script>
<script src="bootstrap/js/bootstrap.js"></script>
<script src="../asset/js/frame/vue.js"></script>
<script src="vendor/bootstrap-select/bootstrap-select.js"></script>
<script src="vendor/bootstrap-datepicker/bootstrap-datepicker.js"></script>
<script src="../asset/easyDialog/js/easydialog.min.js"></script>
<script src="js/components/header.js"></script>
<script src="js/components/sidebar.js"></script>
<script src="js/base.js"></script>
<script src="config/config.js"></script>
<script>
    var Client = new Vue({
        el: "#client",
        data: {
            user: {},
            message: [
                { username: "陈煦", operation: "修改了系统管理员身份"}
            ],
            sidebarLinks: Config.sidebar,
            referLength: 0,
            referShow: [true, false, false, false],
            create: {
                title: "",
                locus: "",
                pdbId: "",
                dbsource: "",
                source: "",
                organism: "",
                date: "",
                country: "",
                origin: "",
                author1: "",
                title1: "",
                journal1: "",
                pubmed1: "",
                abstract1: "",
                author2: "",
                title2: "",
                journal2: "",
                pubmed2: "",
                abstract2: "",
                author3: "",
                title3: "",
                journal3: "",
                pubmed3: "",
                abstract3: "",
                author4: "",
                title4: "",
                journal4: "",
                pubmed4: "",
                abstract4: ""
            }
        },
        components: {
            "navbar": header,
            "sidebar": sidebar
        },
        mounted: function () {
            this.$nextTick(function () {
                init(Client, function() {
                    Client.request("getParam");
                })
            })
        },
        methods: {
            addReference: function() {
                this.referLength++;
                this.referShow[this.referLength] = true;
            },
            /**
             * 向后台发起请求
             * @param type 请求的类型
             */
            request: function(type) {
                var data = null,
                    url = null,
                    successFn = null,
                    errorFn = null,
                    item = null;

                if(type === "getParam") {
                    data = {};
                    url = Service.getUrl("getParam");
                    successFn = Client.getParamCallback;
                } else if(type === "createData") {
                    data = this.create;
                    data.type = $("#selectForType").selectpicker("val");
                    data.ec2 = $("#selectForEC2").selectpicker("val");
                    data.operator = this.user.userName;
                    if(data.title === "" || data.type === "" || data.ec2 === "" ||
                        data.locus === "" || data.pdbId === "" || data.date === "") {
                        Dialog.info("请将必填信息都填写完整");
                        return;
                    }
                    url = Service.getUrl("createData");
                    successFn = Client.createDataCallback;
                }
                Links.connect({
                    method: "post",
                    param: {
                        url: url,
                        data: data,
                        successFn: successFn,
                        errorFn: errorCallback
                    }
                });
            },
            /**
             * 获取参数的回调函数
             * @param msg 服务器返回的对象
             */
            getParamCallback: function(msg) {
                var loop = 0, length = 0, item = null,
                    type = msg.data.type,
                    ec2 = msg.data.ec2,
                    selectForType = $("#selectForType"),
                    selectForEC2 = $("#selectForEC2");

                if(Number(msg.code) === 1) {
                    for(loop = 0, length = type.length; loop < length; loop++) {
                        item = type[loop];
                        $data = "<option value='" + item + "'>" + item + "</option>";
                        selectForType.append($data);
                    }
                    for(loop = 0, length = ec2.length; loop < length; loop++) {
                        item = ec2[loop];
                        $data = "<option value='" + item + "'>" + item + "</option>";
                        selectForEC2.append($data);
                    }
                    $(".selectpicker").selectpicker();
                }
            },
            /**
             * 数据录入执行的回调函数
             * @param msg 服务器返回的对象
             */
            createDataCallback: function(msg) {
                if(Number(msg.code) === 1) {
                    Dialog.info(msg.msg);
                    // 清空输入内容
                    this.create = {
                        title: "",
                        locus: "",
                        pdbId: "",
                        dbsource: "",
                        source: "",
                        organism: "",
                        date: "",
                        country: "",
                        origin: "",
                        author1: "",
                        title1: "",
                        journal1: "",
                        pubmed1: "",
                        abstract1: "",
                        author2: "",
                        title2: "",
                        journal2: "",
                        pubmed2: "",
                        abstract2: "",
                        author3: "",
                        title3: "",
                        journal3: "",
                        pubmed3: "",
                        abstract3: "",
                        author4: "",
                        title4: "",
                        journal4: "",
                        pubmed4: "",
                        abstract4: ""
                    }
                } else {
                    Dialog.warn(msg.msg);
                }
            }
        }
    });
</script>
</body>
</html>